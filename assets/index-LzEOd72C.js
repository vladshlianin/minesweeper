var I=Object.defineProperty;var M=(r,e,t)=>e in r?I(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>M(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const $="modulepreload",S=function(r){return"/minesweeper/"+r},w={},D=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let o=function(a){return Promise.all(a.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(t.map(a=>{if(a=S(a),a in w)return;w[a]=!0;const h=a.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${f}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":$,h||(c.as="script"),c.crossOrigin="",c.href=a,u&&c.setAttribute("nonce",u),document.head.appendChild(c),h)return new Promise((m,C)=>{c.addEventListener("load",m),c.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},E=(r,e)=>{if(e<0)throw new Error("Size must be non-negative");return Array.from(Array(e),()=>Array(e).fill(r))},x=(r,e)=>{let t=null;return()=>{t!==null&&clearTimeout(t),t=setTimeout(r,e)}},F=r=>{const e=Math.floor(r/60),t=r%60;return e>0?`${e} minute${e!==1?"s":""} and ${t} second${t!==1?"s":""}`:`${t} second${t!==1?"s":""}`},P=()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches||window.matchMedia("(prefers-contrast: high)").matches||window.matchMedia("(prefers-contrast: more)").matches,T=new Set(["beginner","intermediate","expert"]),p=r=>typeof r=="string"&&T.has(r),G=()=>{const r=localStorage.getItem("difficulty");return typeof r=="string"&&p(r)?r:"beginner"},B=[[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1],[1,0],[1,1]],v=r=>E("E",r),k=(r,e,[t,n])=>{const i=r.map(c=>[...c]);if(e===0)return i;const s=r.length,o=s**2,l=o-1,u=Math.min(e,l),a=Array.from({length:o},(c,m)=>m);for(let c=a.length-1;c>0;c--){const m=Math.floor(Math.random()*(c+1));[a[c],a[m]]=[a[m],a[c]]}let h=0,f=0;for(;f<u&&h<a.length;){const c=a[h];h++;const m=Math.floor(c/s),C=c%s;(m!==t||C!==n)&&(i[m][C]="M",f++)}return i},L=(r,e,t,n)=>{const i=[];for(const[s,o]of B){const l=t+s,u=n+o;l>=0&&l<r&&u>=0&&u<e&&i.push([l,u])}return i},U=(r,e)=>{const t=r.length,n=r[0].length,i=r.map(o=>[...o]),s=(o,l)=>{if(i[o][l]==="E"){let u=0;const a=L(t,n,o,l);for(const[h,f]of a)i[h][f]==="M"&&u++;if(u)i[o][l]=String(u);else{i[o][l]="RE";for(const[h,f]of a)s(h,f)}}};return s(e[0],e[1]),i},z=(r,e)=>{const t=r.length,n=r[0].length,i=Array.from({length:t},()=>Array(n).fill(!1));i[e[0]][e[1]]=!0;const s=[e];for(;s.length>0;){const[o,l]=s.shift();for(const[u,a]of L(t,n,o,l))if(!i[u][a]){if(r[u][a]==="E"||r[u][a]==="M")return[u,a];i[u][a]=!0,s.push([u,a])}}return null};function N(r,e){if(!r)throw new Error(`Element with id ${e} was not found`)}const y=r=>{if(!r.length)throw new Error("Element id was not provided");const e=document.getElementById(r);return N(e,r),e};class O{constructor(){d(this,"announceEl",y("game-status-announce"))}announceGameReady(e,t,n){const i=`Minesweeper game ready. ${e} difficulty selected. 
      ${t} by ${t} grid with ${n} mines. 
      Use Enter or Left Click to reveal cells. Use Space or Right Click to flag mines. 
      Press the reset button to start a new game.`;this.announce(i)}announceDiffChanged(e,t,n){const i=`Difficulty changed to ${e}. ${t} by ${t} grid with ${n} mines.`;this.announce(i)}announceGameReset(){this.announce("New game started. Board reset. Good luck!")}announceCellFlagged(e,t,n){const i=`row ${e}, column ${t}`,s=n>=0?`${n} flag(s) remaining`:`You've placed too many, remove ${n} flag(s)`;this.announce(`Cell flagged at ${i}. ${s}.`)}announceCellUnflagged(e,t,n){const i=`row ${e}, column ${t}`,s=n>=0?`${n} flag(s) remaining`:`You've placed too many, remove ${n} flag(s)`,o=`Flag removed at ${i}. ${s}.`;this.announce(o)}announceCellRevealed(e,t,n){const i=`row ${e}, column ${t}`;n===0?this.announce(`Empty cell revealed at ${i}. Area cleared automatically.`):this.announce(`Cell revealed at ${i}. ${n} adjacent mine${n>1?"s":""}.`)}announceGameLost(){this.announce("Mine exploded, game over! Press smiley button to start new game.")}announceGameWon(){this.announce("Congratulations, you won! Press smiley button to start new game.")}announceTimeElapsed(e){this.announce(`${F(e)} elapsed.`)}announce(e){this.announceEl.innerText=e}}const g=r=>`/minesweeper/${r}`,b={smileyRegular:g("smiley.png"),smileyVictory:g("smiley-victory.png"),smileyLost:g("smiley-lost.png"),flag:g("flag.png"),collision:g("collision.png"),bomb:g("bomb.png")},A={beginner:[6,4],intermediate:[9,9],expert:[14,35]},R={hideIntermediate:320,hideExpert:480},_=1e3,V=30,q=async()=>{const{showConfetti:r}=await D(async()=>{const{showConfetti:e}=await import("./index-BKKZBfX0.js");return{showConfetti:e}},[]);r(2,1600,1800)};class H{constructor(){d(this,"timerInterval",null);d(this,"minesCount");d(this,"size");d(this,"currentDifficulty");d(this,"flagPositions");d(this,"board");d(this,"remainingFlags");d(this,"gameEnded",!1);d(this,"gameStarted",!1);d(this,"firstClick",!0);d(this,"buttons");d(this,"flagCounterEl",y("flag-count"));d(this,"timerEl",y("timer"));d(this,"boardEl",y("game-board"));d(this,"smileyImgEl",y("smiley-img"));d(this,"resetBtnEl",y("smiley-btn"));d(this,"announcer",new O);this.currentDifficulty=G();const[e,t]=A[this.currentDifficulty];this.remainingFlags=t,this.size=e,this.minesCount=t,this.buttons=this.getDifficultyButtons(),this.flagPositions=E(!1,e),this.board=v(e)}setupEventListeners(){this.resetBtnEl.addEventListener("click",this.onResetClick.bind(this));const e=x(this.onResize.bind(this),200);window.addEventListener("resize",e)}onResetClick(){this.announcer.announceGameReset(),this.resetGame()}initGame(){this.initButtons(),this.setupEventListeners(),this.renderFlagCount(this.minesCount),this.renderCells(this.size),this.setBoardElAria(this.size),this.announcer.announceGameReady(this.currentDifficulty,this.size,this.minesCount)}renderFlagCount(e){this.flagCounterEl.innerText=String(e)}resetGame(){this.renderFlagCount(this.minesCount),this.renderCells(this.size),this.board=v(this.size),this.flagPositions=E(!1,this.size),this.gameEnded=!1,this.smileyImgEl.setAttribute("src",b.smileyRegular),this.remainingFlags=this.minesCount,this.renderFlagCount(this.minesCount),this.gameStarted=!1,this.firstClick=!0,this.resetTimer()}onResize(){const e=window.innerWidth;if(this.currentDifficulty!=="beginner"&&e<=R.hideIntermediate){this.changeDifficulty("beginner");return}this.currentDifficulty==="expert"&&e<=R.hideExpert&&this.changeDifficulty("intermediate")}updateDifficultyButtons(){for(const e of this.buttons)e.classList.contains("active")&&(e.classList.remove("active"),e.removeAttribute("aria-pressed")),e.dataset.difficulty===this.currentDifficulty&&(e.classList.add("active"),e.setAttribute("aria-pressed","true"))}getCellByRowCol(e,t){return this.boardEl.children[e].children[t]}changeDifficulty(e){if(e!==this.currentDifficulty){this.currentDifficulty=e,localStorage.setItem("difficulty",e);const[t,n]=A[e];this.size=t,this.minesCount=n,this.updateDifficultyButtons(),this.announcer.announceDiffChanged(e,this.size,this.minesCount),this.setBoardElAria(t),this.resetGame()}}getDifficultyButtons(){const e=document.querySelectorAll("button[data-difficulty]"),t=[];for(const n of e)n instanceof HTMLButtonElement&&typeof n.dataset.difficulty=="string"&&p(n.dataset.difficulty)&&t.push(n);return t}initButtons(){for(const e of this.buttons){const t=e.dataset.difficulty;!t||!p(t)||(t===this.currentDifficulty&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")),e.addEventListener("click",this.changeDifficulty.bind(this,t)))}}setBoardElAria(e){this.boardEl.setAttribute("aria-rowcount",String(e)),this.boardEl.setAttribute("aria-colcount",String(e))}renderCells(e){for(;this.boardEl.firstChild;)this.boardEl.removeChild(this.boardEl.firstChild);for(let t=0;t<e;t++){const n=document.createElement("div");n.className="row",n.setAttribute("role","row");for(let i=0;i<e;i++){const s=document.createElement("button");s.className="cell",s.setAttribute("tabIndex",t===0&&i===0?"0":"-1"),s.setAttribute("aria-label","Unrevealed cell"),s.setAttribute("aria-atomic","true"),s.setAttribute("aria-live","off"),s.setAttribute("role","gridcell"),s.setAttribute("aria-rowindex",String(t+1)),s.setAttribute("aria-colindex",String(i+1)),s.addEventListener("click",this.revealCell.bind(this,t,i)),s.addEventListener("keydown",o=>this.onCellKeyDown(o,t,i)),s.addEventListener("contextmenu",o=>{o.preventDefault(),this.toggleFlag(t,i)}),n.appendChild(s)}this.boardEl.appendChild(n)}}moveFocus(e,t){if(e>=0&&e<this.size&&t>=0&&t<this.size){const n=this.getCellByRowCol(e,t);if(n instanceof HTMLElement){n.focus();const i=this.board[e][t];if(i==="E"||i==="M"){const s=this.boardEl.querySelectorAll('[tabindex="0"]');for(const o of s)o==null||o.setAttribute("tabIndex","-1");n.setAttribute("tabIndex","0")}}}}onCellKeyDown(e,t,n){if(!this.gameEnded)switch(e.key){case"ArrowUp":{this.moveFocus(t-1,n);break}case"ArrowDown":{this.moveFocus(t+1,n);break}case"ArrowLeft":{this.moveFocus(t,n-1);break}case"ArrowRight":{this.moveFocus(t,n+1);break}case"Enter":{e.preventDefault(),this.revealCell(t,n);break}case" ":{e.preventDefault(),this.toggleFlag(t,n);break}}}toggleFlag(e,t){if(!this.gameEnded){this.gameStarted||this.startGame();const n=this.getCellByRowCol(e,t),i=this.board[e][t];if(i==="E"||i==="M"){const s=this.flagPositions[e][t];if(this.flagPositions[e][t]=!s,s){for(;n.firstChild;)n.removeChild(n.firstChild);n.classList.remove("flag"),n.setAttribute("aria-label","Unrevealed cell"),this.remainingFlags++,this.announcer.announceCellUnflagged(e+1,t+1,this.remainingFlags)}if(!s){const o=document.createElement("img");o.setAttribute("src",b.flag),o.setAttribute("width","20px"),o.setAttribute("height","20px"),n.appendChild(o),n.classList.add("flag"),n.setAttribute("aria-label","Marked as flag. Press spacebar to unmark"),this.remainingFlags--,this.announcer.announceCellFlagged(e+1,t+1,this.remainingFlags)}}this.renderFlagCount(this.remainingFlags)}}renderMineCell(e,t){const n=document.createElement("img");n.setAttribute("src",e==="RM"?b.collision:b.bomb),n.setAttribute("width","20px"),n.setAttribute("height","20px"),n.setAttribute("aria-hidden","true"),t.appendChild(n),e==="RM"&&(t.setAttribute("aria-label","Exploded mine. Go back and start a new game or change difficulty"),t.classList.add("collision")),e==="M"&&(t.setAttribute("aria-label","Mine"),t.classList.add("mine"))}renderCellUpdate(e,t,n){const i=this.getCellByRowCol(e,t);if(i.classList.add("revealed"),i.setAttribute("tabIndex","-1"),n==="RE"&&i.setAttribute("aria-label","Revealed empty cell"),n==="RM"||n==="M"){this.renderMineCell(n,i);return}n!=="RE"&&(i.classList.add(`cell-${n}`),i.innerHTML=n,i.setAttribute("aria-label",`Cell revealed, ${n} adjacent mine(s)`))}revealMines(e){const t=this.board.length;for(let n=0;n<t;n++)for(let i=0;i<t;i++){const s=this.board[n][i];!this.flagPositions[n][i]&&(s==="M"||s==="RM")&&(e?this.toggleFlag(n,i):this.renderCellUpdate(n,i,s))}}endGame(e){this.gameEnded=!0,this.smileyImgEl.setAttribute("src",e?b.smileyVictory:b.smileyLost),this.clearTabIndexFromCells(),e&&!P()&&q(),e&&this.announcer.announceGameWon(),e||this.announcer.announceGameLost()}clearTabIndexFromCells(){for(const e of this.boardEl.children)for(const t of e.children)t.getAttribute("tabIndex")==="0"&&t.setAttribute("tabIndex","-1")}startGame(){this.gameStarted=!0;let e=0;this.timerInterval=setInterval(()=>{if(this.gameEnded&&this.timerInterval!==null){clearInterval(this.timerInterval);return}e++,this.timerEl.innerText=String(e).padStart(2,"0"),e%V===0&&e>0&&this.announcer.announceTimeElapsed(e)},_)}resetTimer(){this.timerInterval!==null&&clearInterval(this.timerInterval),this.timerEl.innerText="00"}continueGameAfterReveal(e,t){const n=z(this.board,[e,t]);n&&this.getCellByRowCol(n[0],n[1]).setAttribute("tabIndex","0");const i=this.board[e][t];this.announcer.announceCellRevealed(e+1,t+1,i!=="RE"?parseInt(i,10):0)}revealCell(e,t){if(!this.gameEnded){if(this.gameStarted||this.startGame(),this.firstClick&&(this.board=k(this.board,this.minesCount,[e,t]),this.firstClick=!1),this.flagPositions[e][t])return;if(this.board[e][t]==="M"){this.board[e][t]="RM",this.endGame(!1),this.revealMines(!1);return}const n=U(this.board,[e,t]);let i=!1;for(let s=0;s<this.size;s++)for(let o=0;o<this.size;o++)n[s][o]==="E"&&(i=!0),n[s][o]!==this.board[s][o]&&(this.flagPositions[s][o]&&this.toggleFlag(s,o),this.renderCellUpdate(s,o,n[s][o]));this.board=n,i?this.continueGameAfterReveal(e,t):(this.revealMines(!0),this.endGame(!0))}}}const K=()=>{new H().initGame()};document.addEventListener("DOMContentLoaded",K);
