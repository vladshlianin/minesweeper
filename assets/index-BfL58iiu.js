var x=Object.defineProperty;var L=(o,e,t)=>e in o?x(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var u=(o,e,t)=>L(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const M="modulepreload",$=function(o){return"/minesweeper/"+o},w={},S=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let r=function(l){return Promise.all(l.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),d=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=r(t.map(l=>{if(l=$(l),l in w)return;w[l]=!0;const h=l.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":M,h||(c.as="script"),c.crossOrigin="",c.href=l,d&&c.setAttribute("nonce",d),document.head.appendChild(c),h)return new Promise((m,b)=>{c.addEventListener("load",m),c.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return i.then(r=>{for(const a of r||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},E=(o,e)=>{if(e<0)throw new Error("Size must be non-negative");return Array.from(Array(e),()=>Array(e).fill(o))},D=(o,e)=>{let t=null;return()=>{t!==null&&clearTimeout(t),t=setTimeout(o,e)}},F=o=>{const e=Math.floor(o/60),t=o%60;return e>0?`${e} minute${e!==1?"s":""} and ${t} second${t!==1?"s":""}`:`${t} second${t!==1?"s":""}`},P=()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches||window.matchMedia("(prefers-contrast: high)").matches||window.matchMedia("(prefers-contrast: more)").matches,T=new Set(["beginner","intermediate","expert"]),p=o=>typeof o=="string"&&T.has(o),B=()=>{const o=localStorage.getItem("difficulty");return typeof o=="string"&&p(o)?o:"beginner"},G=[[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1],[1,0],[1,1]],v=o=>E("E",o),k=(o,e,[t,n])=>{const i=o.map(c=>[...c]);if(e===0)return i;const s=o.length,r=s**2,a=r-1,d=Math.min(e,a),l=Array.from({length:r},(c,m)=>m);for(let c=l.length-1;c>0;c--){const m=Math.floor(Math.random()*(c+1));[l[c],l[m]]=[l[m],l[c]]}let h=0,f=0;for(;f<d&&h<l.length;){const c=l[h];h++;const m=Math.floor(c/s),b=c%s;(m!==t||b!==n)&&(i[m][b]="M",f++)}return i},R=(o,e,t,n)=>{const i=[];for(const[s,r]of G){const a=t+s,d=n+r;a>=0&&a<o&&d>=0&&d<e&&i.push([a,d])}return i},z=(o,e)=>{const t=o.length,n=o[0].length,i=o.map(r=>[...r]),s=(r,a)=>{if(i[r][a]==="E"){let d=0;const l=R(t,n,r,a);for(const[h,f]of l)i[h][f]==="M"&&d++;if(d)i[r][a]=String(d);else{i[r][a]="RE";for(const[h,f]of l)s(h,f)}}};return s(e[0],e[1]),i},U=(o,e)=>{const t=o.length,n=o[0].length,i=Array.from({length:t},()=>Array(n).fill(!1));i[e[0]][e[1]]=!0;const s=[e];for(;s.length>0;){const[r,a]=s.shift();for(const[d,l]of R(t,n,r,a))if(!i[d][l]){if(o[d][l]==="E"||o[d][l]==="M")return[d,l];i[d][l]=!0,s.push([d,l])}}return null};function N(o,e){if(!o)throw new Error(`Element with id ${e} was not found`)}const g=o=>{if(!o.length)throw new Error("Element id was not provided");const e=document.getElementById(o);return N(e,o),e};class O{constructor(){u(this,"announceEl",g("game-status-announce"))}announceGameReady(e,t,n){const i=`Minesweeper game ready. ${e} difficulty selected. 
      ${t} by ${t} grid with ${n} mines. 
      Use Enter or Left Click to reveal cells. Use Space or Right Click to flag mines. 
      Press the reset button to start a new game.`;this.announce(i)}announceDiffChanged(e,t,n){const i=`Difficulty changed to ${e}. ${t} by ${t} grid with ${n} mines.`;this.announce(i)}announceGameReset(){this.announce("New game started. Board reset. Good luck!")}announceCellFlagged(e,t,n){const i=`row ${e}, column ${t}`,s=n>=0?`${n} flag(s) remaining`:`You've placed too many, remove ${n} flag(s)`;this.announce(`Cell flagged at ${i}. ${s}.`)}announceCellUnflagged(e,t,n){const i=`row ${e}, column ${t}`,s=n>=0?`${n} flag(s) remaining`:`You've placed too many, remove ${n} flag(s)`,r=`Flag removed at ${i}. ${s}.`;this.announce(r)}announceCellRevealed(e,t,n){const i=`row ${e}, column ${t}`;n===0?this.announce(`Empty cell revealed at ${i}. Area cleared automatically.`):this.announce(`Cell revealed at ${i}. ${n} adjacent mine${n>1?"s":""}.`)}announceGameLost(){this.announce("Mine exploded, game over! Press smiley button to start new game.")}announceGameWon(){this.announce("Congratulations, you won! Press smiley button to start new game.")}announceTimeElapsed(e){this.announce(`${F(e)} elapsed.`)}announce(e){this.announceEl.innerText=e}}const C=o=>`/minesweeper/${o}`,y={smileyRegular:C("smiley.png"),smileyVictory:C("smiley-victory.png"),smileyLost:C("smiley-lost.png"),flag:C("flag.png")},A={beginner:[6,4],intermediate:[9,9],expert:[14,35]},I={hideIntermediate:320,hideExpert:480},_=1e3,V=30,q=async()=>{const{showConfetti:o}=await S(async()=>{const{showConfetti:e}=await import("./index-BKKZBfX0.js");return{showConfetti:e}},[]);o(2,1600,1800)};class H{constructor(){u(this,"timerInterval",null);u(this,"minesCount");u(this,"size");u(this,"currentDifficulty");u(this,"flagPositions");u(this,"board");u(this,"remainingFlags");u(this,"gameEnded",!1);u(this,"gameStarted",!1);u(this,"firstClick",!0);u(this,"buttons");u(this,"flagCounterEl",g("flag-count"));u(this,"timerEl",g("timer"));u(this,"boardEl",g("game-board"));u(this,"smileyImgEl",g("smiley-img"));u(this,"resetBtnEl",g("smiley-btn"));u(this,"announcer",new O);this.currentDifficulty=B();const[e,t]=A[this.currentDifficulty];this.remainingFlags=t,this.size=e,this.minesCount=t,this.buttons=this.getDifficultyButtons(),this.flagPositions=E(!1,e),this.board=v(e)}setupEventListeners(){this.resetBtnEl.addEventListener("click",this.onResetClick.bind(this));const e=D(this.onResize.bind(this),200);window.addEventListener("resize",e)}onResetClick(){this.announcer.announceGameReset(),this.resetGame()}initGame(){this.initButtons(),this.setupEventListeners(),this.renderFlagCount(this.minesCount),this.renderCells(this.size),this.setBoardElAria(this.size),this.announcer.announceGameReady(this.currentDifficulty,this.size,this.minesCount)}renderFlagCount(e){this.flagCounterEl.innerText=String(e)}resetGame(){this.renderFlagCount(this.minesCount),this.renderCells(this.size),this.board=v(this.size),this.flagPositions=E(!1,this.size),this.gameEnded=!1,this.smileyImgEl.setAttribute("src",y.smileyRegular),this.remainingFlags=this.minesCount,this.renderFlagCount(this.minesCount),this.gameStarted=!1,this.firstClick=!0,this.resetTimer()}onResize(){const e=window.innerWidth;if(this.currentDifficulty!=="beginner"&&e<=I.hideIntermediate){this.changeDifficulty("beginner");return}this.currentDifficulty==="expert"&&e<=I.hideExpert&&this.changeDifficulty("intermediate")}getRowColByIndex(e){return{row:Math.floor(e/this.size),col:e%this.size}}getIndexByRowCol(e,t){return e*this.size+t}updateDifficultyButtons(){for(const e of this.buttons)e.classList.contains("active")&&(e.classList.remove("active"),e.removeAttribute("aria-pressed")),e.dataset.difficulty===this.currentDifficulty&&(e.classList.add("active"),e.setAttribute("aria-pressed","true"))}changeDifficulty(e){if(e!==this.currentDifficulty){this.currentDifficulty=e,localStorage.setItem("difficulty",e);const[t,n]=A[e];this.size=t,this.minesCount=n,this.updateDifficultyButtons(),this.announcer.announceDiffChanged(e,this.size,this.minesCount),this.setBoardElAria(t),this.resetGame()}}getDifficultyButtons(){const e=document.querySelectorAll("button[data-difficulty]"),t=[];for(const n of e)n instanceof HTMLButtonElement&&typeof n.dataset.difficulty=="string"&&p(n.dataset.difficulty)&&t.push(n);return t}initButtons(){for(const e of this.buttons){const t=e.dataset.difficulty;!t||!p(t)||(t===this.currentDifficulty&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")),e.addEventListener("click",this.changeDifficulty.bind(this,t)))}}setBoardElAria(e){this.boardEl.setAttribute("aria-rowcount",String(e)),this.boardEl.setAttribute("aria-colcount",String(e))}resetCells(){const e=this.boardEl.childElementCount;for(let t=0;t<e;t++){const n=this.boardEl.children[t],{row:i,col:s}=this.getRowColByIndex(t);n.className="cell",n.setAttribute("tabIndex",t===0?"0":"-1"),n.setAttribute("aria-label","Unrevealed cell"),n.setAttribute("aria-rowindex",String(i+1)),n.setAttribute("aria-colindex",String(s+1))}for(const t of this.boardEl.children)for(;t.firstChild;)t.removeChild(t.firstChild)}removeCells(e){for(let t=0;t<Math.abs(e)&&this.boardEl.lastChild;t++)this.boardEl.removeChild(this.boardEl.lastChild)}addCells(e,t){for(let n=e;n<t;n++){const{row:i,col:s}=this.getRowColByIndex(n),r=document.createElement("button");r.className="cell",r.setAttribute("tabIndex",n===0?"0":"-1"),r.setAttribute("aria-label","Unrevealed cell"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","off"),r.setAttribute("role","gridcell"),r.setAttribute("aria-rowindex",String(i+1)),r.setAttribute("aria-colindex",String(s+1)),r.addEventListener("click",this.revealCell.bind(this,n)),r.addEventListener("keydown",a=>this.onCellKeyDown(a,n)),r.addEventListener("contextmenu",a=>{a.preventDefault(),this.toggleFlag(i,s)}),this.boardEl.appendChild(r)}}renderCells(e){this.boardEl.style.gridTemplateColumns=`repeat(${e}, max-content)`;const t=e**2,n=t-this.boardEl.childElementCount;this.resetCells(),n<=0?this.removeCells(n):this.addCells(t-n,t)}moveFocus(e,t){if(e>=0&&e<this.size&&t>=0&&t<this.size){const n=this.getIndexByRowCol(e,t),i=this.boardEl.children[n];if(i instanceof HTMLElement){i.focus();const s=this.board[e][t];if(s==="E"||s==="M"){const r=this.boardEl.querySelector('[tabindex="0"]');r==null||r.setAttribute("tabIndex","-1"),i.setAttribute("tabIndex","0")}}}}onCellKeyDown(e,t){if(!this.gameEnded){const{row:n,col:i}=this.getRowColByIndex(t);switch(e.key){case"ArrowUp":{this.moveFocus(n-1,i);break}case"ArrowDown":{this.moveFocus(n+1,i);break}case"ArrowLeft":{this.moveFocus(n,i-1);break}case"ArrowRight":{this.moveFocus(n,i+1);break}case"Enter":{e.preventDefault(),this.revealCell(t);break}case" ":{e.preventDefault(),this.toggleFlag(n,i);break}}}}toggleFlag(e,t){if(!this.gameEnded){this.gameStarted||this.startGame();const n=this.getIndexByRowCol(e,t),i=this.boardEl.children[n],s=this.board[e][t];if(s==="E"||s==="M"){const r=this.flagPositions[e][t];if(this.flagPositions[e][t]=!r,r){for(;i.firstChild;)i.removeChild(i.firstChild);i.classList.remove("flag"),i.setAttribute("aria-label","Unrevealed cell"),this.remainingFlags++,this.announcer.announceCellUnflagged(e+1,t+1,this.remainingFlags)}if(!r){const a=document.createElement("img");a.setAttribute("src",y.flag),a.setAttribute("width","20px"),a.setAttribute("height","20px"),i.appendChild(a),i.classList.add("flag"),i.setAttribute("aria-label","Marked as flag. Press spacebar to unmark"),this.remainingFlags--,this.announcer.announceCellFlagged(e+1,t+1,this.remainingFlags)}}this.renderFlagCount(this.remainingFlags)}}renderMineCell(e,t){const n=document.createElement("img");n.setAttribute("src",e==="RM"?"/collision.png":"/bomb.png"),n.setAttribute("width","20px"),n.setAttribute("height","20px"),n.setAttribute("aria-hidden","true"),t.appendChild(n),e==="RM"&&(t.setAttribute("aria-label","Exploded mine. Go back and start a new game or change difficulty"),t.classList.add("collision")),e==="M"&&(t.setAttribute("aria-label","Mine"),t.classList.add("mine"))}renderCellUpdate(e,t,n){const i=e*this.size+t,s=this.boardEl.children[i];if(s.classList.add("revealed"),s.setAttribute("tabIndex","-1"),n==="RE"&&s.setAttribute("aria-label","Revealed empty cell"),n==="RM"||n==="M"){this.renderMineCell(n,s);return}n!=="RE"&&(s.classList.add(`cell-${n}`),s.innerHTML=n,s.setAttribute("aria-label",`Cell revealed, ${n} adjacent mine(s)`))}revealMines(e){const t=this.board.length;for(let n=0;n<t;n++)for(let i=0;i<t;i++){const s=this.board[n][i];!this.flagPositions[n][i]&&(s==="M"||s==="RM")&&(e?this.toggleFlag(n,i):this.renderCellUpdate(n,i,s))}}endGame(e){this.gameEnded=!0,this.smileyImgEl.setAttribute("src",e?y.smileyVictory:y.smileyLost),this.clearTabIndexFromCells(),e&&!P()&&q(),e&&this.announcer.announceGameWon(),e||this.announcer.announceGameLost()}clearTabIndexFromCells(){for(const e of this.boardEl.children)e.getAttribute("tabIndex")==="0"&&e.setAttribute("tabIndex","-1")}startGame(){this.gameStarted=!0;let e=0;this.timerInterval=setInterval(()=>{if(this.gameEnded&&this.timerInterval!==null){clearInterval(this.timerInterval);return}e++,this.timerEl.innerText=String(e).padStart(2,"0"),e%V===0&&e>0&&this.announcer.announceTimeElapsed(e)},_)}resetTimer(){this.timerInterval!==null&&clearInterval(this.timerInterval),this.timerEl.innerText="00"}continueGameAfterReveal(e,t){const n=U(this.board,[e,t]);if(n){const s=this.getIndexByRowCol(n[0],n[1]);this.boardEl.children[s].setAttribute("tabIndex","0")}const i=this.board[e][t];this.announcer.announceCellRevealed(e+1,t+1,i!=="RE"?parseInt(i,10):0)}revealCell(e){if(!this.gameEnded){this.gameStarted||this.startGame();const{row:t,col:n}=this.getRowColByIndex(e);if(this.firstClick&&(this.board=k(this.board,this.minesCount,[t,n]),this.firstClick=!1),this.flagPositions[t][n])return;if(this.board[t][n]==="M"){this.board[t][n]="RM",this.endGame(!1),this.revealMines(!1);return}const i=z(this.board,[t,n]);let s=!1;for(let r=0;r<this.size;r++)for(let a=0;a<this.size;a++)i[r][a]==="E"&&(s=!0),i[r][a]!==this.board[r][a]&&(this.flagPositions[r][a]&&this.toggleFlag(r,a),this.renderCellUpdate(r,a,i[r][a]));this.board=i,s?this.continueGameAfterReveal(t,n):(this.revealMines(!0),this.endGame(!0))}}}const K=()=>{new H().initGame()};document.addEventListener("DOMContentLoaded",K);
